---
format: pdf
execute:
    echo: false
---

```{r}
#| output: false
library(tidyr)
library(dplyr)
library(broom)
library(ggplot2)
library(car)
```

# Explora√ß√£o e an√°lise descritiva

```{r}
#| output: false
# Carregar os dados
base_url <- "https://raw.githubusercontent.com/vincentarelbundock/Rdatasets/"
file_path <- "ba3186b8413f4d40d8f38120c32bcd31797e8d5e/csv/Stat2Data/FruitFlies.csv"
dat <- read.csv(paste0(base_url, file_path)) |>
  select(ID, Longevity, everything(), -rownames) |>
  mutate(
    Treatment =
      factor(Treatment,
        levels = c(
          "none",
          "1 pregnant", "1 virgin", "8 pregnant", "8 virgin"
        )
      ),
    Type = factor(
      case_when(
        Type == 0 ~ "prenha",
        Type == 1 ~ "virgem",
        Type == 9 ~ "nenhuma",
        TRUE ~ NA_character_
      ),
      levels = c("nenhuma", "prenha", "virgem")
    )
  )
head(dat)
```

## Item a

Categorizar√≠amos a longevidade (Longevity), tempo em sono (Sleep) e medida do tamanho corporal (Thorax) como quantiativas cont√≠nuas, enquanto o tipo (Type), tratamento (Treatment), n√∫mero de parceiros (Partners), como categ√≥ricas.

Al√©m das vari√°veis citadas, tamb√©m identificamos as vari√°veis "Partners" (n√∫mero de parceiras), "Type" (tipo das parceiras), "Thorax" (comprimento do t√≥rax em mm), "Sleep" (percentual do dia desprendido dormindo). Classificamos "Partners" como quantitativa discreta, "Type" e "Treatment" como qualitativa nominal, "Longevity", "Thorax" e "Sleep" como quantitativas cont√≠nuas.

## Item b

Esses fatores n√£o se encaixam integralmente como aninhados ou cruzados, mas podemos dizer que apresentam tend√™ncia cruzada.

## Item c

√â importante examinar se h√° dados faltantes e presen√ßa de outliers.

```{r}
# Verifica√ß√£o de dados faltantes
sum(is.na(dat))
```

Pelo resultado do R, n√£o foram encontrados dados faltantes.

```{r}
boxplot(Longevity ~ Treatment,
  data = dat, title = "Longevidade por tratamento",
  xlabel = "Tratamento", ylabel = "Longevidade em dias"
)
```

O boxplot aponta aus√™ncia de outliers. Tamb√©m verificamos que todos os dados de cada coluna da tabela s√£o do tipo esperado, isso √©, as categorias s√£o as apresentadas no contexto e os valores respeitam os tipos de vari√°veis explicitados em a).

## Item d

Al√©m do boxplot criado para verificar o tratamento, podemos criar gr√°ficos de dispers√£o para comparar a longevidade e o t√≥rax (intr√≠nseco):

```{r}
ggplot(dat, aes(
  y = Longevity, x = Thorax,
  xlabel = "Tamanhho do t√≥rax", ylabel = "Longevidade em dias"
)) +
  geom_point() +
  ggtitle("Longevidade por tamanho do t√≥rax") +
  theme_minimal()
```

E outras vari√°veis entre si:

```{r}
boxplot(Sleep ~ Treatment,
  data = dat, main = "% do dia despendido dormindo por tratamento",
  xlabel = "Tratamento", ylabel = "Tempo do dia em sono (%)"
)

ggplot(dat, aes(x = Sleep, y = Longevity, color = Treatment)) +
  geom_point() +
  ggtitle("Rela√ß√£o entre Longevidade, Tratamento e Tempo em Sono") +
  theme_minimal()
```

# Exerc√≠cio 3

ANOVA Longevidade x Tipo

```{r}
# In√∫til, tirar
summary(aov(data = dat, Longevity ~ Type))
```

ANOVA Longevidade x Parceiros

```{r}
# In√∫til e desconexo, tirar
summary(aov(data = dat, Longevity ~ Partners))
```

ANOVA Longevidade x Tratamento

```{r}
# In√∫til e desconexo, tirar
summary(aov(data = dat, Longevity ~ Treatment))
```

## Item a

Considerando o modelos com apenas um fator de tratamento, mostre a soma de quadrados total, soma de quadrados do tratamento, soma de quadrados do erro, graus de liberdade, e os quadrados m√©dios, e monte uma tabela anova. Considerando um n√≠vel de signific√¢ncia de ùõº = 0.05, quais s√£o as conclus√µes?

```{r}
anova1 <- aov(Longevity ~ Type, data = dat)
summary(anova1)
```

\begin{table}[H]
\centering
\caption{Tabela de ANOVA}
\begin{tabular}{lccccc}
\toprule
\textbf{Causa de Varia√ß√£o} & \textbf{Soma de Quadrados (SQ)} & \textbf{GL} & \textbf{QM} & \textbf{F} & p-valor \\
\midrule
Tratamento & 7845  & 2   & 3923 & 15.74 & 8.3e-07\\
Res√≠duo    & 30407 & 122 & 249  &       &   \\
\midrule
Total      & 38252 & 124 &      &       &   \\
\bottomrule
\end{tabular}
\end{table}

A \$5%& de sisgnific√¢ncia estat√≠stica, conclui-se que h√° evid√™ncias para rejeitar a hip√≥tese nula que que o os tratamentos n√£o t√™m efeito sobre a observa√ß√£o. Ou seja, deixar os machos com f√™meas prenhas, virgens ou sem nenhuma f√™mea afeta a longevidade deles. Contudo, n√£o √© poss√≠vel definir qual dos tratamentos √© significativamente efetivo sobre a longevidade.

## Item b

```{r}
residuos <- resid(anova1)


# Testando normalidade
f <- function(x) qnorm(x)
qqnorm(residuos)
qqline(residuos)

# Passou raspando
shapiro.test(residuos)

# Testando independ√™ncia
plot(residuos)


# Testando homocedasticidade


plot(anova1$fitted.values, anova1$residuals,
  xlab = "Valores preditos",
  ylab = "Res√≠duos",
  main = "Res√≠duos vs Valores preditos"
)
abline(h = 0, col = "red", lwd = 2)

# H0 vari√¢ncias iguais | √â menos sens√≠vel a normalidade
leveneTest(Longevity ~ Type, data = dat)

# H0 vari√¢ncias iguais | √â melhor quando n√£o rejeitamos normalidade
bartlett.test(Longevity ~ Type, data = dat)
```

Pela an√°lise do qq-plot, os res√≠duos parecem n√£o violar a hip√≥tese de normalidade. Pelo teste de Shapiro‚ÄìWilk, a $5%$ de signific√¢ncia estat√≠stica, n√£o rejeitamos $H_0$ de que os res√≠duos v√™m de uma distribui√ß√£o normal. Portanto, podemos seguir para os pr√≥ximos passos do diagn√≥stico do modelo.

Do plot da evolu√ß√£o dos res√≠duos com a evolu√ß√£o do tempo, n√£o √© poss√≠vel observar nenhuma tend√™ncia de depend√™ncia entre as observa√ß√µes, ent√£o possivelmente n√£o h√° autocorrela√ß√£o.

Do plot de res√≠duos x valores preditos, nota-se que os res√≠duos aparentam apresentar uma mesma vari√¢ncia dentro de cada tratamento. Formalmente, realizamos os testes de Levene e de Bartlett, os quais n√£o rejeitaram a hip√≥tese nula de homocedasticidade a $5%$ de signific√¢ncia estat√≠stica. Note que, uma vez que n√£o rejeitamos a hip√≥tese de normalidade, o teste de Bertlett √© mais indicado para esse conjundo de dados.

## Item c

```{r}
anova1$coefficients
```

No contexto do experimento, a interpreta√ß√£o dos coeficientes estimados indica que a longevidade m√©dia dos machos mantidos sem f√™meas √© de aproximadamente $63.6$ dias. Para os machos mantidos com f√™meas prenhas, a longevidade √© estatisticamente equivalente, apresentando um acr√©scimo m√©dio muito pequeno (cerca de $0.5$ dias), o que sugere que a presen√ßa de f√™meas n√£o receptivas n√£o altera substancialmente o tempo de vida dos machos. J√° para os machos mantidos com f√™meas virgens receptivas, a longevidade apresenta uma redu√ß√£o expressiva, em torno de $15.8$ dias a menos em m√©dia, revelando que a atividade sexual efetiva tem um efeito negativo marcante sobre a longevidade. Assim, a conclus√£o √© que n√£o √© apenas a presen√ßa de f√™meas que importa, mas sim a demanda reprodutiva ativa, a qual implica custos fisiol√≥gicos que reduzem a sobreviv√™ncia dos machos.

